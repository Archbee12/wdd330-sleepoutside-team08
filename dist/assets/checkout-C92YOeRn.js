import{g as n,f as c,l,u}from"./CartCount-B4q7_aba.js";import{E as h}from"./ExternalServices-OHBWtN4X.js";const d=new h;class p{constructor(e,t){this.key=e,this.outputSelector=t,this.list=[],this.itemTotal=0,this.shipping=0,this.tax=0,this.orderTotal=0}init(){this.list=n(this.key),this.calculateItemSubTotal(),this.calculateOrderTotal(),this.displayOrderTotals()}calculateItemSubTotal(){this.itemTotal=0;let e=0;this.list.forEach(s=>{const r=s.quantity||1;this.itemTotal+=s.FinalPrice*r,e+=r});const t=document.querySelector(`${this.outputSelector} #subtotal`),o=document.querySelector(`${this.outputSelector} #num-items`);t&&(t.textContent=`$${this.itemTotal.toFixed(2)}`),o&&(o.textContent=e)}calculateOrderTotal(){this.tax=this.itemTotal*.06;const e=this.list.reduce((t,o)=>t+(o.quantity||1),0);this.shipping=e>0?10+(e-1)*2:0,this.orderTotal=this.itemTotal+this.tax+this.shipping,this.displayOrderTotals()}displayOrderTotals(){const e=document.querySelector(`${this.outputSelector} #tax`),t=document.querySelector(`${this.outputSelector} #shipping`),o=document.querySelector(`${this.outputSelector} #order-total`);e&&(e.textContent=`$${this.tax.toFixed(2)}`),t&&(t.textContent=`$${this.shipping.toFixed(2)}`),o&&(o.textContent=`$${this.orderTotal.toFixed(2)}`)}packageItems(e){return e.map(t=>({id:t.Id||t.id,name:t.Name||t.name,price:t.FinalPrice||t.price,quantity:t.quantity||1}))}async checkout(){console.log("checkout function triggered");const e=document.forms.checkout,t=c(e);console.log("Order from form:",t),t.orderDate=new Date().toISOString(),t.orderTotal=this.orderTotal,t.tax=this.tax,t.shipping=this.shipping,t.items=this.packageItems(this.list),console.log("Final order data:",t);const o={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)};try{const r=await(await fetch("https://wdd330-backend.onrender.com:3000/checkout",o)).json();console.log("Server response:",r)}catch(s){console.error("Checkout error:",s)}try{const s=await d.checkout(t);console.log(s)}catch(s){console.log(s)}}}l().then(()=>{u()});const a=new p("so-cart",".order-summary");a.init();document.addEventListener("DOMContentLoaded",()=>{const i=document.querySelector("#zip");i&&i.addEventListener("blur",()=>{a.calculateOrderTotal()});const e=document.querySelector("#checkout-form");e&&e.addEventListener("submit",t=>{t.target.checkValidity()?(t.preventDefault(),alert("Order Submitted!")):(t.preventDefault(),alert("Please fill out all required fields."))})});
